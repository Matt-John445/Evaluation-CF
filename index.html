<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Formation DIR - Minist√®re de la Transition √©cologique</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
            background: #f5f5f5;
            color: #333;
            line-height: 1.5;
        }
        
        .gov-header {
            background: #fff;
            border-bottom: 3px solid #000091;
            padding: 12px 0;
        }
        
        .container {
            max-width: 1300px;
            margin: 0 auto;
            padding: 0 20px;
        }
        
        .gov-identity {
            display: flex;
            align-items: center;
            gap: 20px;
        }
        
        .gov-logo {
            display: flex;
            align-items: center;
            gap: 15px;
        }
        
        .flag {
            display: flex;
            height: 150px;
        }
        
        .gov-text {
            border-left: 2px solid #ddd;
            padding-left: 35px;
        }
        
        .gov-text .republic {
            font-size: 16px;
            color: #666;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }
        
        .gov-text .ministry {
            font-size: 20px;
            color: #000091;
            font-weight: 600;
            margin-top: 2px;
        }
        
        .nav-secondary {
            background: #000091;
            color: white;
            padding: 15px 0;
        }
        
        .nav-title {
            font-size: 20px;
            font-weight: 600;
        }
        
        .nav-subtitle {
            font-size: 14px;
            opacity: 0.9;
            margin-top: 3px;
        }
        
        .main-tabs {
            background: white;
            border-bottom: 1px solid #e0e0e0;
            padding: 0 20px;
        }
        
        .tabs-nav {
            display: flex;
            max-width: 1300px;
            margin: 0 auto;
            overflow-x: auto;
        }
        
        .tab-btn {
            padding: 15px 20px;
            background: none;
            border: none;
            cursor: pointer;
            font-size: 14px;
            font-weight: 600;
            color: #666;
            border-bottom: 3px solid transparent;
            white-space: nowrap;
            transition: all 0.2s;
        }
        
        .tab-btn:hover {
            color: #000091;
            background: #f0f0f0;
        }
        
        .tab-btn.active {
            color: #000091;
            border-bottom-color: #000091;
            background: #f0f0f0;
        }
        
        .main-content {
            padding: 30px 0;
        }
        
        .tab-content {
            display: none;
            max-width: 1300px;
            margin: 0 auto;
            padding: 0 20px;
        }
        
        .tab-content.active {
            display: block;
        }
        
        .content-card {
            background: white;
            border-radius: 4px;
            padding: 30px;
            margin-bottom: 20px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }
        
        .content-header {
            border-bottom: 1px solid #e0e0e0;
            padding-bottom: 20px;
            margin-bottom: 30px;
        }
        
        .content-header h1 {
            font-size: 28px;
            color: #1e1e1e;
            margin-bottom: 8px;
        }
        
        .content-header p {
            color: #666;
            font-size: 16px;
        }
        
        /* Accueil - Cards de navigation */
        .welcome-section {
            text-align: center;
            margin-bottom: 40px;
        }
        
        .welcome-section h2 {
            font-size: 32px;
            color: #000091;
            margin-bottom: 10px;
        }
        
        .welcome-section p {
            font-size: 18px;
            color: #666;
        }
        
        .nav-cards {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 20px;
            margin-top: 30px;
        }
        
        .nav-card {
            background: white;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            padding: 30px;
            cursor: pointer;
            transition: all 0.3s;
            text-align: center;
        }
        
        .nav-card:hover {
            border-color: #000091;
            box-shadow: 0 4px 12px rgba(0,0,145,0.15);
            transform: translateY(-2px);
        }
        
        .nav-card-icon {
            font-size: 48px;
            margin-bottom: 15px;
        }
        
        .nav-card h3 {
            font-size: 20px;
            color: #000091;
            margin-bottom: 10px;
        }
        
        .nav-card p {
            color: #666;
            font-size: 14px;
        }
        
        /* Formulaires */
        .form-group {
            margin-bottom: 20px;
        }
        
        .form-label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #1e1e1e;
        }
        
        .form-label .required {
            color: #e1000f;
        }
        
        .form-input,
        .form-select,
        .form-textarea {
            width: 100%;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-size: 14px;
            transition: border-color 0.2s;
            font-family: inherit;
        }
        
        .form-textarea {
            min-height: 80px;
            resize: vertical;
        }
        
        .form-input:focus,
        .form-select:focus,
        .form-textarea:focus {
            outline: none;
            border-color: #000091;
            box-shadow: 0 0 0 2px rgba(0, 0, 145, 0.1);
        }
        
        .form-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
        }
        
        .form-section {
            border: 1px solid #e0e0e0;
            padding: 20px;
            border-radius: 4px;
            background: #f9f9f9;
        }
        
        .section-title {
            font-size: 18px;
            font-weight: 700;
            color: #000091;
            margin-bottom: 15px;
            border-bottom: 2px solid #000091;
            padding-bottom: 5px;
        }
        
        /* Candidats multiples */
        .candidat-item {
            background: white;
            border: 1px solid #ddd;
            border-radius: 4px;
            padding: 20px;
            margin-bottom: 20px;
            position: relative;
        }
        
        .candidat-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
            padding-bottom: 10px;
            border-bottom: 2px solid #000091;
        }
        
        .candidat-number {
            font-size: 18px;
            font-weight: 700;
            color: #000091;
        }
        
        .btn-remove-candidat {
            background: #dc143c;
            color: white;
            border: none;
            padding: 6px 12px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 12px;
        }
        
        .btn-remove-candidat:hover {
            background: #b8112d;
        }
        
        /* Boutons */
        .btn {
            display: inline-block;
            padding: 12px 24px;
            font-size: 14px;
            font-weight: 600;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            transition: all 0.2s;
            text-decoration: none;
            margin: 5px;
        }
        
        .btn-primary {
            background: #000091;
            color: white;
        }
        
        .btn-primary:hover {
            background: #0000b3;
        }
        
        .btn-secondary {
            background: #fff;
            color: #000091;
            border: 1px solid #000091;
        }
        
        .btn-secondary:hover {
            background: #f0f0f0;
        }
        
        .btn-success {
            background: #00a651;
            color: white;
        }
        
        .btn-success:hover {
            background: #008a45;
        }
        
        .score-input {
            width: 80px;
            text-align: center;
        }
        
        .toast {
            position: fixed;
            top: 20px;
            right: 20px;
            background: #4CAF50;
            color: white;
            padding: 16px 20px;
            border-radius: 4px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.3);
            transform: translateX(400px);
            transition: transform 0.3s ease;
            z-index: 10000;
            max-width: 350px;
        }
        
        .toast.show {
            transform: translateX(0);
        }
        
        .toast.error {
            background: #f44336;
        }
        
        .toast.warning {
            background: #ff9800;
        }
        
        .toast.info {
            background: #2196F3;
        }
        
        .toast-title {
            font-weight: bold;
            margin-bottom: 4px;
        }
        
        .toast-message {
            font-size: 14px;
            opacity: 0.9;
        }
        
        .footer {
            background: #1e1e1e;
            color: white;
            padding: 30px 0;
            margin-top: 50px;
        }
        
        @media (max-width: 768px) {
            .form-grid {
                grid-template-columns: 1fr;
            }
            
            .nav-cards {
                grid-template-columns: 1fr;
            }
        }
        
        .access-denied {
            text-align: center;
            padding: 50px;
            color: #666;
        }
        
        .access-denied h2 {
            color: #dc143c;
            margin-bottom: 15px;
        }
        
        .evaluation-section {
            margin: 20px 0;
            padding: 20px;
            border: 1px solid #ddd;
            border-radius: 4px;
            background: #f9f9f9;
        }
        
        .score-row {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin: 10px 0;
            padding: 10px;
            background: white;
            border-radius: 4px;
        }
        
        .score-label {
            flex: 1;
            font-weight: 500;
        }
        
        .score-max {
            color: #666;
            margin: 0 10px;
        }
        
        .total-score {
            background: #000091;
            color: white;
            padding: 15px;
            border-radius: 4px;
            text-align: center;
            font-size: 18px;
            font-weight: 700;
            margin: 20px 0;
        }
    </style>
</head>
<body>
    <div class="toast" id="toast">
        <div class="toast-title" id="toast-title"></div>
        <div class="toast-message" id="toast-message"></div>
    </div>

    <header class="gov-header">
        <div class="container">
            <div class="gov-identity">
                <div class="gov-logo">
                    <div class="flag">
                        <img src="https://upload.wikimedia.org/wikipedia/fr/thumb/b/bf/Logo_Minist%C3%A8re_Am%C3%A9nagement_du_territoire_D%C3%A9centralisation_Logement_Transports_Ruralit%C3%A9_Ville.jpg/1200px-Logo_Minist%C3%A8re_Am%C3%A9nagement_du_territoire_D%C3%A9centralisation_Logement_Transports_Ruralit%C3%A9_Ville.jpg" alt="R√©publique Fran√ßaise">
                    </div>
                    <div class="gov-text">
                        <div class="republic">R√©publique Fran√ßaise</div>
                        <div class="ministry">Minist√®re de l'Am√©nagement du Territoire et de la D√©centralisation</div>
                    </div>
                </div>
            </div>
        </div>
    </header>
    
    <nav class="nav-secondary">
        <div class="container">
            <div class="nav-title">Direction Interd√©partementale des Routes</div>
            <div class="nav-subtitle">Plateforme de gestion des √©valuations</div>
        </div>
    </nav>
    
    <div id="auth-section" class="main-content">
        <div class="content-card" style="max-width: 500px; margin: 50px auto;">
            <div class="content-header">
                <h1>Identification du candidat</h1>
                <p>Veuillez renseigner vos informations pour acc√©der √† la formation</p>
            </div>
            
            <div class="form-group">
                <label class="form-label">Nom <span class="required">*</span></label>
                <input type="text" class="form-input" id="user-name" required>
            </div>
            
            <div class="form-group">
                <label class="form-label">Pr√©nom <span class="required">*</span></label>
                <input type="text" class="form-input" id="user-firstname" required>
            </div>
            
            <div class="form-group">
                <label class="form-label">Type de formation <span class="required">*</span></label>
                <select class="form-select" id="user-role" required>
                    <option value="">S√©lectionnez...</option>
                    <option value="formateur-certifie">Formateur certifi√©</option>
                    <option value="formateur-test">Formateur en test</option>
                    <option value="aide-formateur">Aide-formateur</option>
                </select>
            </div>
            
            <button type="button" class="btn btn-primary" onclick="authenticate()">Continuer</button>
        </div>
    </div>
    
    <div id="main-platform" style="display: none;">
        <div class="main-tabs">
            <div class="tabs-nav">
                <button class="tab-btn active" onclick="showTab('accueil')">Accueil</button>
                <button class="tab-btn" onclick="showTab('evaluation-non-formees')">√âvaluation Non Form√©es</button>
                <button class="tab-btn" onclick="showTab('resultat-formation')">R√©sultats Formation</button>
                <button class="tab-btn" onclick="showTab('evaluation-formateur')" id="tab-eval-formateur" style="display: none;">√âvaluation Formateur</button>
                <button class="tab-btn" onclick="showTab('fiche-presence')">Fiche de Pr√©sence</button>
            </div>
        </div>
        
        <main class="main-content">
            <div class="tab-content active" id="tab-accueil">
                <div class="content-card">
                    <div class="welcome-section">
                        <h2>Bienvenue sur la plateforme DIR</h2>
                        <p>S√©lectionnez une section pour commencer</p>
                    </div>
                    
                    <div class="nav-cards">
                        <div class="nav-card" onclick="showTab('evaluation-non-formees')">
                            <div class="nav-card-icon"></div>
                            <h3>√âvaluation Non Form√©es</h3>
                            <p>√âvaluation pratique et th√©orique des candidats</p>
                        </div>
                        
                        <div class="nav-card" onclick="showTab('resultat-formation')">
                            <div class="nav-card-icon"></div>
                            <h3>R√©sultats Formation</h3>
                            <p>Compilation des r√©sultats de session</p>
                        </div>
                        
                        <div class="nav-card" onclick="showTab('evaluation-formateur')" id="card-eval-formateur" style="display: none;">
                            <div class="nav-card-icon"></div>
                            <h3>√âvaluation Formateur</h3>
                            <p>√âvaluation des aide-formateurs</p>
                        </div>
                        
                        <div class="nav-card" onclick="showTab('fiche-presence')">
                            <div class="nav-card-icon"></div>
                            <h3>Fiche de Pr√©sence</h3>
                            <p>Enregistrement des pr√©sences</p>
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="tab-content" id="tab-evaluation-non-formees">
                <div class="content-card">
                    <div class="content-header">
                        <h1>√âvaluation des Non Form√©es</h1>
                        <p>√âvaluation pratique et th√©orique des candidats non form√©s</p>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">Date <span class="required">*</span></label>
                        <input type="date" class="form-input" id="eval-date" required>
                    </div>
                    
                    <div id="candidats-container"></div>
                    
                    <button type="button" class="btn btn-secondary" onclick="addCandidat()">+ Ajouter un candidat</button>
                    <button type="button" class="btn btn-primary" onclick="submitAllEvaluations()">Envoyer toutes les √©valuations</button>
                </div>
            </div>
            
            <div class="tab-content" id="tab-resultat-formation">
                <div class="content-card">
                    <div class="content-header">
                        <h1>R√©sultats de Formation</h1>
                        <p>Compilation des r√©sultats d'une session de formation</p>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">Date <span class="required">*</span></label>
                        <input type="date" class="form-input" id="results-date" required>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">Identit√©s des candidats (un par ligne) <span class="required">*</span></label>
                        <textarea class="form-textarea" id="all-candidates" placeholder="Nom Pr√©nom&#10;Nom Pr√©nom&#10;..." style="min-height: 120px;" required></textarea>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">Personnes admises en tant que stagiaire (un par ligne)</label>
                        <textarea class="form-textarea" id="admitted-candidates" placeholder="Nom Pr√©nom&#10;Nom Pr√©nom&#10;..." style="min-height: 120px;"></textarea>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">Ont pass√© leur formation mais ont √©t√© refus√©s (un par ligne)</label>
                        <textarea class="form-textarea" id="refused-candidates" placeholder="Nom Pr√©nom&#10;Nom Pr√©nom&#10;..." style="min-height: 120px;"></textarea>
                    </div>
                    
                    <button type="button" class="btn btn-primary" onclick="submitResultsFormation()">Envoyer les r√©sultats</button>
                </div>
            </div>
            
            <div class="tab-content" id="tab-evaluation-formateur">
                <div class="content-card">
                    <div class="content-header">
                        <h1>√âvaluation Aide-formateur / Formateur en test</h1>
                        <p>R√©serv√© aux formateurs certifi√©s</p>
                    </div>
                    
                    <div id="formateur-access-denied" class="access-denied" style="display: none;">
                        <h2>Acc√®s restreint</h2>
                        <p>Cette section est r√©serv√©e aux formateurs certifi√©s uniquement.</p>
                    </div>
                    
                    <div id="formateur-eval-form">
                        <div class="form-group">
                            <label class="form-label">Date de la formation <span class="required">*</span></label>
                            <input type="date" class="form-input" id="formateur-date" required>
                        </div>
                        
                        <div class="form-group">
                            <label class="form-label">Identit√© de la personne √©valu√©e <span class="required">*</span></label>
                            <input type="text" class="form-input" id="personne-evaluee" placeholder="Nom et pr√©nom" required>
                        </div>
                        
                        <div class="form-group">
                            <label class="form-label">Identit√© du formateur <span class="required">*</span></label>
                            <input type="text" class="form-input" id="formateur-evaluateur" required>
                        </div>
                        
                        <div class="evaluation-section">
                            <div class="section-title">Crit√®res d'√©valuation</div>
                            
                            <div class="form-group">
                                <label class="form-label">Clart√© des explications <span class="required">*</span></label>
                                <textarea class="form-textarea" id="clarte-explications" required></textarea>
                            </div>
                            
                            <div class="form-group">
                                <label class="form-label">Capacit√© d'adaptation et p√©dagogie <span class="required">*</span></label>
                                <textarea class="form-textarea" id="adaptation-pedagogie" required></textarea>
                            </div>
                            
                            <div class="form-group">
                                <label class="form-label">Interaction et communication <span class="required">*</span></label>
                                <textarea class="form-textarea" id="interaction-communication" required></textarea>
                            </div>
                            
                            <div class="form-group">
                                <label class="form-label">Ma√Ætrise des cours <span class="required">*</span></label>
                                <textarea class="form-textarea" id="maitrise-cours" required></textarea>
                            </div>
                            
                            <div class="form-group">
                                <label class="form-label">Utilisation du support d'√©valuation des candidats <span class="required">*</span></label>
                                <textarea class="form-textarea" id="utilisation-support" required></textarea>
                            </div>
                            
                            <div class="form-group">
                                <label class="form-label">Informations compl√©mentaires</label>
                                <textarea class="form-textarea" id="infos-complementaires"></textarea>
                            </div>
                        </div>
                        
                        <button type="button" class="btn btn-primary" onclick="submitFormateurEvaluation()">Envoyer l'√©valuation</button>
                    </div>
                </div>
            </div>
            
            <div class="tab-content" id="tab-fiche-presence">
                <div class="content-card">
                    <div class="content-header">
                        <h1>Fiche de Pr√©sence Formateurs</h1>
                        <p>Enregistrement de la pr√©sence des formateurs</p>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">Date de formation <span class="required">*</span></label>
                        <input type="date" class="form-input" id="presence-date" required>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">Type de formation <span class="required">*</span></label>
                        <select class="form-select" id="presence-type" required>
                            <option value="">S√©lectionnez...</option>
                            <option value="Initiale">Formation Initiale</option>
                            <option value="Continue">Formation Continue</option>
                            <option value="Recyclage">Recyclage</option>
                            <option value="Sp√©cialis√©e">Formation Sp√©cialis√©e</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">Formateurs pr√©sents (un par ligne) <span class="required">*</span></label>
                        <textarea class="form-textarea" id="formateurs-presents" placeholder="Nom Pr√©nom - Statut (Certifi√©/Test/Aide)&#10;Nom Pr√©nom - Statut&#10;..." style="min-height: 120px;" required></textarea>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">Heure de d√©but</label>
                        <input type="time" class="form-input" id="heure-debut">
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">Heure de fin</label>
                        <input type="time" class="form-input" id="heure-fin">
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">Observations</label>
                        <textarea class="form-textarea" id="observations-presence" placeholder="Remarques particuli√®res, incidents, etc."></textarea>
                    </div>
                    
                    <button type="button" class="btn btn-primary" onclick="submitFichePresence()">Envoyer la fiche de pr√©sence</button>
                </div>
            </div>
        </main>
    </div>
    
    <footer class="footer">
        <div class="container">
            <p>¬© Galax R√¥leplay 2025 - Tous droits r√©serv√©s. Toute reproduction, distribution ou utilisation non autoris√©e du contenu est strictement interdite et r√©glement√©e.</p>
        </div>
    </footer>
    
    <script>
        const WEBHOOKS = {
            evaluationNonFormees: 'https://discord.com/api/webhooks/1420488869685624844/0-jiH63lVXOXEVA3JwLPfu4fe9diGVk_qoX-F2clfl-BNQvKdp7gbqdn9RvzrKoMDro6',
            resultatsFormation: 'https://discord.com/api/webhooks/1420489387015147550/mCOoORv-OOXnrc-LWYeiWH1bI8xGMoSrPREJudNDcsljCBA_jiZbWqOYzyLRHtnj32jZ',
            evaluationFormateur: 'https://discord.com/api/webhooks/1420489482171453667/BGp0Xw2qFDKKrkV0eu5ebXkLkJdra58tS3jy03oSA4yPkdnhdZ_OrYX21Nn0RmBazpYl',
            fichePresence: 'https://discord.com/api/webhooks/1420489584848146492/fCwIXkGqbc8oolHupRoNbnnM0jKS6tPjojkoZ0sVEwz0JFU9sOwIJxKkIyODFc-CQCCK'
        };
        
        let currentUser = { name: '', firstname: '', role: '' };
        let candidatCounter = 0;
        
        function getFrenchDateTime() {
            return new Date().toLocaleString('fr-FR', { timeZone: 'Europe/Paris', year: 'numeric', month: '2-digit', day: '2-digit', hour: '2-digit', minute: '2-digit' });
        }
        
        function getFrenchDate() {
            return new Date().toLocaleDateString('fr-FR', { timeZone: 'Europe/Paris', year: 'numeric', month: '2-digit', day: '2-digit' }).split('/').reverse().join('-');
        }
        
        function authenticate() {
            const name = document.getElementById('user-name').value.trim();
            const firstname = document.getElementById('user-firstname').value.trim();
            const role = document.getElementById('user-role').value;
            
            if (!name || !firstname || !role) {
                showToast('Erreur', 'Veuillez remplir tous les champs', 'error');
                return;
            }
            
            currentUser = { name, firstname, role };
            
            document.getElementById('auth-section').style.display = 'none';
            document.getElementById('main-platform').style.display = 'block';
            
            setupUserAccess(role);
            prefillUserFields();
            addCandidat();
            
            showToast('Connexion r√©ussie', `Bienvenue ${firstname} ${name}`, 'success');
        }
        
        function setupUserAccess(role) {
            const evalFormateurTab = document.getElementById('tab-eval-formateur');
            const cardEvalFormateur = document.getElementById('card-eval-formateur');
            const evalFormateurAccess = document.getElementById('formateur-access-denied');
            const evalFormateurForm = document.getElementById('formateur-eval-form');
            
            if (role === 'formateur-certifie') {
                evalFormateurTab.style.display = 'block';
                cardEvalFormateur.style.display = 'block';
                evalFormateurAccess.style.display = 'none';
                evalFormateurForm.style.display = 'block';
            } else {
                evalFormateurTab.style.display = 'none';
                cardEvalFormateur.style.display = 'none';
            }
        }
        
        function prefillUserFields() {
            const formateurEvaluateur = document.getElementById('formateur-evaluateur');
            if (formateurEvaluateur) {
                formateurEvaluateur.value = `${currentUser.firstname} ${currentUser.name}`;
            }
            
            const today = getFrenchDate();
            document.getElementById('eval-date').value = today;
            document.getElementById('results-date').value = today;
            document.getElementById('formateur-date').value = today;
            document.getElementById('presence-date').value = today;
        }
        
        function showTab(tabName) {
            document.querySelectorAll('.tab-content').forEach(tab => tab.classList.remove('active'));
            document.querySelectorAll('.tab-btn').forEach(btn => btn.classList.remove('active'));
            
            document.getElementById(`tab-${tabName}`).classList.add('active');
            
            const clickedBtn = Array.from(document.querySelectorAll('.tab-btn')).find(btn => 
                btn.getAttribute('onclick')?.includes(tabName)
            );
            if (clickedBtn) clickedBtn.classList.add('active');
        }
        
        function addCandidat() {
            candidatCounter++;
            const container = document.getElementById('candidats-container');
            
            const candidatDiv = document.createElement('div');
            candidatDiv.className = 'candidat-item';
            candidatDiv.id = `candidat-${candidatCounter}`;
            candidatDiv.dataset.id = candidatCounter;
            
            candidatDiv.innerHTML = `
                <div class="candidat-header">
                    <span class="candidat-number">Candidat #${candidatCounter}</span>
                    <button type="button" class="btn-remove-candidat" onclick="removeCandidat(${candidatCounter})">‚úï Supprimer</button>
                </div>
                
                <div class="form-group">
                    <label class="form-label">Nom du candidat <span class="required">*</span></label>
                    <input type="text" class="form-input" id="candidat-name-${candidatCounter}" placeholder="Nom et pr√©nom" required>
                </div>
                
                <div class="evaluation-section">
                    <div class="section-title">√âpreuve Pratique</div>
                    <div class="score-row">
                        <span class="score-label">Parcours de conduite</span>
                        <span class="score-max">/ 4</span>
                        <input type="number" class="form-input score-input" id="conduite-${candidatCounter}" min="0" max="4" step="0.5" data-candidat="${candidatCounter}">
                    </div>
                </div>
                
                <div class="evaluation-section">
                    <div class="section-title">Situations de Balisage</div>
                    <div class="score-row">
                        <span class="score-label">Situation N¬∞1 - Route en ville</span>
                        <span class="score-max">/ 5</span>
                        <input type="number" class="form-input score-input" id="situation1-${candidatCounter}" min="0" max="5" step="0.5" data-candidat="${candidatCounter}">
                    </div>
                    <div class="score-row">
                        <span class="score-label">Situation N¬∞2 - Rond-point</span>
                        <span class="score-max">/ 5</span>
                        <input type="number" class="form-input score-input" id="situation2-${candidatCounter}" min="0" max="5" step="0.5" data-candidat="${candidatCounter}">
                    </div>
                    <div class="score-row">
                        <span class="score-label">Situation N¬∞3 - Autoroute</span>
                        <span class="score-max">/ 5</span>
                        <input type="number" class="form-input score-input" id="situation3-${candidatCounter}" min="0" max="5" step="0.5" data-candidat="${candidatCounter}">
                    </div>
                </div>
                
                <div class="evaluation-section">
                    <div class="section-title">Questions Th√©oriques</div>
                    <div class="score-row">
                        <span class="score-label">La DIR est-elle une soci√©t√© priv√©e ou fait-elle partie du secteur public ?</span>
                        <span class="score-max">/ 1</span>
                        <input type="number" class="form-input score-input" id="q1-${candidatCounter}" min="0" max="1" step="0.5" data-candidat="${candidatCounter}">
                    </div>
                    <div class="score-row">
                        <span class="score-label">Quel v√©hicule n'a-t-on pas le droit de conduire en √©tant A3 (hors sp√©cialit√©) ?</span>
                        <span class="score-max">/ 2</span>
                        <input type="number" class="form-input score-input" id="q2-${candidatCounter}" min="0" max="2" step="0.5" data-candidat="${candidatCounter}">
                    </div>
                    <div class="score-row">
                        <span class="score-label">Comment se rendre sur une intervention ?</span>
                        <span class="score-max">/ 2</span>
                        <input type="number" class="form-input score-input" id="q3-${candidatCounter}" min="0" max="2" step="0.5" data-candidat="${candidatCounter}">
                    </div>
                    <div class="score-row">
                        <span class="score-label">Que signifie F.L.U (Fl√®che Lumineuse d'Urgence) ?</span>
                        <span class="score-max">/ 1</span>
                        <input type="number" class="form-input score-input" id="q4-${candidatCounter}" min="0" max="1" step="0.5" data-candidat="${candidatCounter}">
                    </div>
                    <div class="score-row">
                        <span class="score-label">La DIR peut-elle passer au feu rouge lors d'une intervention ?</span>
                        <span class="score-max">/ 1</span>
                        <input type="number" class="form-input score-input" id="q5-${candidatCounter}" min="0" max="1" step="0.5" data-candidat="${candidatCounter}">
                    </div>
                    <div class="score-row">
                        <span class="score-label">Quels sont les v√©hicules que l'on peut remorquer avec la d√©panneuse ?</span>
                        <span class="score-max">/ 1</span>
                        <input type="number" class="form-input score-input" id="q6-${candidatCounter}" min="0" max="1" step="0.5" data-candidat="${candidatCounter}">
                    </div>
                    <div class="score-row">
                        <span class="score-label">Que faut-il faire apr√®s chaque fin d'intervention ?</span>
                        <span class="score-max">/ 2</span>
                        <input type="number" class="form-input score-input" id="q7-${candidatCounter}" min="0" max="2" step="0.5" data-candidat="${candidatCounter}">
                    </div>
                    <div class="score-row">
                        <span class="score-label">Est-il possible de conduire un Renault Trafic en √©tant A3 ?</span>
                        <span class="score-max">/ 1</span>
                        <input type="number" class="form-input score-input" id="q8-${candidatCounter}" min="0" max="1" step="0.5" data-candidat="${candidatCounter}">
                    </div>
                    <div class="score-row">
                        <span class="score-label">√Ä quoi correspond la tenue orange et la tenue jaune/bleu ?</span>
                        <span class="score-max">/ 1</span>
                        <input type="number" class="form-input score-input" id="q9-${candidatCounter}" min="0" max="1" step="0.5" data-candidat="${candidatCounter}">
                    </div>
                </div>
                
                <div class="total-score" id="total-score-${candidatCounter}">
                    R√©sultat Total: <span id="score-value-${candidatCounter}">0</span> / 31 (Minimum 24 sur 31)
                </div>
            `;
            
            container.appendChild(candidatDiv);
            
            const inputs = candidatDiv.querySelectorAll('.score-input');
            inputs.forEach(input => {
                input.addEventListener('input', () => updateCandidatScore(candidatCounter));
            });
        }
        
        function removeCandidat(id) {
            const candidat = document.getElementById(`candidat-${id}`);
            if (candidat) {
                candidat.remove();
                showToast('Candidat supprim√©', 'Le candidat a √©t√© retir√© de la liste', 'info');
            }
        }
        
        function updateCandidatScore(id) {
            const fields = ['conduite', 'situation1', 'situation2', 'situation3', 'q1', 'q2', 'q3', 'q4', 'q5', 'q6', 'q7', 'q8', 'q9'];
            let total = 0;
            
            fields.forEach(field => {
                const input = document.getElementById(`${field}-${id}`);
                if (input) {
                    total += parseFloat(input.value) || 0;
                }
            });
            
            const scoreValue = document.getElementById(`score-value-${id}`);
            const totalScoreDiv = document.getElementById(`total-score-${id}`);
            
            if (scoreValue) scoreValue.textContent = total.toFixed(1);
            if (totalScoreDiv) {
                totalScoreDiv.style.background = total >= 24 ? '#00a651' : '#dc143c';
            }
        }
        
        function submitAllEvaluations() {
            const date = document.getElementById('eval-date').value;
            if (!date) {
                showToast('Erreur', 'Veuillez s√©lectionner une date', 'error');
                return;
            }
            
            const candidats = document.querySelectorAll('.candidat-item');
            if (candidats.length === 0) {
                showToast('Erreur', 'Aucun candidat √† √©valuer', 'error');
                return;
            }
            
            let submitted = 0;
            candidats.forEach((candidat, index) => {
                const id = candidat.dataset.id;
                const name = document.getElementById(`candidat-name-${id}`).value.trim();
                
                if (!name) {
                    showToast('Erreur', `Le nom du candidat #${index + 1} est requis`, 'error');
                    return;
                }
                
                const data = {
                    date: date,
                    candidat: name,
                    scores: {
                        conduite: document.getElementById(`conduite-${id}`).value || 0,
                        situation1: document.getElementById(`situation1-${id}`).value || 0,
                        situation2: document.getElementById(`situation2-${id}`).value || 0,
                        situation3: document.getElementById(`situation3-${id}`).value || 0,
                        q1: document.getElementById(`q1-${id}`).value || 0,
                        q2: document.getElementById(`q2-${id}`).value || 0,
                        q3: document.getElementById(`q3-${id}`).value || 0,
                        q4: document.getElementById(`q4-${id}`).value || 0,
                        q5: document.getElementById(`q5-${id}`).value || 0,
                        q6: document.getElementById(`q6-${id}`).value || 0,
                        q7: document.getElementById(`q7-${id}`).value || 0,
                        q8: document.getElementById(`q8-${id}`).value || 0,
                        q9: document.getElementById(`q9-${id}`).value || 0
                    },
                    total: document.getElementById(`score-value-${id}`).textContent
                };
                
                const totalScore = parseFloat(data.total);
                const passed = totalScore >= 24;
                
                const discordMessage = {
                    content: `üìã **√âVALUATION NON FORM√âES**`,
                    embeds: [{
                        title: 'üìä FORMATION INITIALE - √âVALUATION',
                        color: passed ? 0x00a651 : 0xdc143c,
                        fields: [
                            { name: 'üìÖ Date', value: data.date, inline: true },
                            { name: 'üë§ Candidat(e)', value: data.candidat, inline: true },
                            { name: 'üìä R√©sultat', value: `**${data.total}/31** ${passed ? '‚úÖ ADMIS' : '‚ùå √âCHEC'}`, inline: true },
                            { name: 'üöó Parcours de conduite', value: `*${data.scores.conduite}/4*`, inline: true },
                            { name: 'üèôÔ∏è Situation N¬∞1 (Route ville)', value: `*${data.scores.situation1}/5*`, inline: true },
                            { name: 'üîÑ Situation N¬∞2 (Rond-point)', value: `*${data.scores.situation2}/5*`, inline: true },
                            { name: 'üõ£Ô∏è Situation N¬∞3 (Autoroute)', value: `*${data.scores.situation3}/5*`, inline: true },
                            { name: '‚ùì Questions th√©oriques', value: `**Q1: ${data.scores.q1}/1 | Q2: ${data.scores.q2}/2 | Q3: ${data.scores.q3}/2 | Q4: ${data.scores.q4}/1 | Q5: ${data.scores.q5}/1 | Q6: ${data.scores.q6}/1 | Q7: ${data.scores.q7}/2 | Q8: ${data.scores.q8}/1 | Q9: ${data.scores.q9}/1**`, inline: false }
                        ],
                        footer: { text: `√âvalu√© par: ${currentUser.firstname} ${currentUser.name} - ${getFrenchDateTime()}` },
                        timestamp: new Date().toISOString()
                    }]
                };
                
                fetch(WEBHOOKS.evaluationNonFormees, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(discordMessage)
                })
                .then(response => {
                    if (response.ok) submitted++;
                    if (submitted === candidats.length) {
                        showToast('Succ√®s', `${submitted} √©valuation(s) envoy√©e(s)`, 'success');
                        document.getElementById('candidats-container').innerHTML = '';
                        candidatCounter = 0;
                        addCandidat();
                    }
                });
            });
        }
        
        function submitResultsFormation() {
            const date = document.getElementById('results-date').value;
            const allCandidates = document.getElementById('all-candidates').value.trim();
            const admittedCandidates = document.getElementById('admitted-candidates').value.trim();
            const refusedCandidates = document.getElementById('refused-candidates').value.trim();
            
            if (!date || !allCandidates) {
                showToast('Erreur', 'Veuillez remplir tous les champs obligatoires', 'error');
                return;
            }
            
            const discordMessage = {
                content: `üéØ **R√âSULTATS DE FORMATION**`,
                embeds: [{
                    title: 'üìà R√âSULTAT FORMATION : Initiale',
                    color: 0x000091,
                    description: `**Date :** ${date}\n‚ñ¨‚ñ¨‚ñ¨‚ñ¨‚ñ¨‚ñ¨‚ñ¨‚ñ¨‚ñ¨‚ñ¨‚ñ¨\n\n**Identit√©s des candidats :**\n${allCandidates.split('\n').map(name => `- ${name.trim()}`).join('\n')}\n\n‚ñ¨‚ñ¨‚ñ¨‚ñ¨‚ñ¨‚ñ¨‚ñ¨‚ñ¨‚ñ¨‚ñ¨‚ñ¨\n\n**Personnes admises :**\n${admittedCandidates ? admittedCandidates.split('\n').map(name => `- ${name.trim()}`).join('\n') : '- Aucun'}\n\n**Personnes refus√©es :**\n${refusedCandidates ? refusedCandidates.split('\n').map(name => `- ${name.trim()}`).join('\n') : '- Aucun'}\n\n‚ñ¨‚ñ¨‚ñ¨‚ñ¨‚ñ¨‚ñ¨‚ñ¨‚ñ¨‚ñ¨‚ñ¨‚ñ¨`,
                    footer: { text: `Rapporteur: ${currentUser.firstname} ${currentUser.name} - ${getFrenchDateTime()}` },
                    timestamp: new Date().toISOString()
                }]
            };
            
            sendToDiscord(WEBHOOKS.resultatsFormation, discordMessage, 'R√©sultats de formation envoy√©s');
        }
        
        function submitFormateurEvaluation() {
            if (currentUser.role !== 'formateur-certifie') {
                showToast('Acc√®s refus√©', 'R√©serv√© aux formateurs certifi√©s', 'error');
                return;
            }
            
            const data = {
                date: document.getElementById('formateur-date').value,
                personneEvaluee: document.getElementById('personne-evaluee').value,
                formateurEvaluateur: document.getElementById('formateur-evaluateur').value,
                clarteExplications: document.getElementById('clarte-explications').value,
                adaptationPedagogie: document.getElementById('adaptation-pedagogie').value,
                interactionCommunication: document.getElementById('interaction-communication').value,
                maitriseCours: document.getElementById('maitrise-cours').value,
                utilisationSupport: document.getElementById('utilisation-support').value,
                infosComplementaires: document.getElementById('infos-complementaires').value
            };
            
            if (!data.date || !data.personneEvaluee || !data.clarteExplications) {
                showToast('Erreur', 'Veuillez remplir tous les champs obligatoires', 'error');
                return;
            }
            
            const discordMessage = {
                content: `üë®‚Äçüè´ **√âVALUATION FORMATEUR**`,
                embeds: [{
                    title: 'üìù √âvaluation Aide-formateur/Formateur en test',
                    color: 0xff6600,
                    description: `**Date :** ${data.date}\n‚ñ¨‚ñ¨‚ñ¨‚ñ¨‚ñ¨‚ñ¨‚ñ¨‚ñ¨‚ñ¨‚ñ¨‚ñ¨\n\n**Personne √©valu√©e :** ${data.personneEvaluee}\n**Formateur :** ${data.formateurEvaluateur}\n\n‚ñ¨‚ñ¨‚ñ¨‚ñ¨‚ñ¨‚ñ¨‚ñ¨‚ñ¨‚ñ¨‚ñ¨‚ñ¨\n\n**Clart√© des explications :** ${data.clarteExplications}\n\n**Capacit√© d'adaptation :** ${data.adaptationPedagogie}\n\n**Interaction :** ${data.interactionCommunication}\n\n**Ma√Ætrise des cours :** ${data.maitriseCours}\n\n**Utilisation du support :** ${data.utilisationSupport}\n\n‚ñ¨‚ñ¨‚ñ¨‚ñ¨‚ñ¨‚ñ¨‚ñ¨‚ñ¨‚ñ¨‚ñ¨‚ñ¨\n\n**Informations compl√©mentaires :**\n${data.infosComplementaires || 'Aucune'}`,
                    footer: { text: `√âvalu√© par: ${currentUser.firstname} ${currentUser.name} - ${getFrenchDateTime()}` },
                    timestamp: new Date().toISOString()
                }]
            };
            
            sendToDiscord(WEBHOOKS.evaluationFormateur, discordMessage, '√âvaluation formateur envoy√©e');
        }
        
        function submitFichePresence() {
            const data = {
                date: document.getElementById('presence-date').value,
                type: document.getElementById('presence-type').value,
                formateursPresents: document.getElementById('formateurs-presents').value.trim(),
                heureDebut: document.getElementById('heure-debut').value,
                heureFin: document.getElementById('heure-fin').value,
                observations: document.getElementById('observations-presence').value
            };
            
            if (!data.date || !data.type || !data.formateursPresents) {
                showToast('Erreur', 'Veuillez remplir tous les champs obligatoires', 'error');
                return;
            }
            
            const discordMessage = {
                content: `üìù **FICHE DE PR√âSENCE**`,
                embeds: [{
                    title: 'üë• Fiche de Pr√©sence - Formation DIR',
                    color: 0x2196f3,
                    fields: [
                        { name: 'üìÖ Date', value: data.date, inline: true },
                        { name: 'üìö Type', value: data.type, inline: true },
                        { name: '‚è∞ Horaires', value: `${data.heureDebut || 'Non renseign√©'} - ${data.heureFin || 'Non renseign√©'}`, inline: true },
                        { name: 'üë®‚Äçüè´ Formateurs pr√©sents', value: data.formateursPresents.split('\n').map(f => `‚Ä¢ ${f.trim()}`).join('\n'), inline: false },
                        { name: 'üìã Observations', value: data.observations || 'Aucune', inline: false }
                    ],
                    footer: { text: `Rapporteur: ${currentUser.firstname} ${currentUser.name} - ${getFrenchDateTime()}` },
                    timestamp: new Date().toISOString()
                }]
            };
            
            sendToDiscord(WEBHOOKS.fichePresence, discordMessage, 'Fiche de pr√©sence envoy√©e');
        }
        
        function sendToDiscord(webhookUrl, message, successMessage) {
            fetch(webhookUrl, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify(message)
            })
            .then(response => {
                if (response.ok) {
                    showToast('Succ√®s', successMessage, 'success');
                } else {
                    throw new Error(`Erreur HTTP: ${response.status}`);
                }
            })
            .catch(error => {
                console.error('Erreur:', error);
                showToast('Erreur', '√âchec de l\'envoi', 'error');
            });
        }
        
        function showToast(title, message, type = 'success') {
            const toast = document.getElementById('toast');
            const toastTitle = document.getElementById('toast-title');
            const toastMessage = document.getElementById('toast-message');
            
            toast.className = 'toast';
            if (type === 'error') toast.classList.add('error');
            if (type === 'warning') toast.classList.add('warning');
            if (type === 'info') toast.classList.add('info');
            
            toastTitle.textContent = title;
            toastMessage.textContent = message;
            
            toast.classList.add('show');
            setTimeout(() => toast.classList.remove('show'), 4000);
        }
    </script>
</body>
</html>
